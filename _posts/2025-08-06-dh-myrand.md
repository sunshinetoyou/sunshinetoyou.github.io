---
layout: post
title: "[DH]MyRand"
date: 2025-08-06 03:39 +0900
category: Write-Up
tag: [dreamhack, reversing]
---
### **INFO**
![chall]
_Fig 1. Challenge_

### **RECON**
ELF 실행파일과 Flag 파일 하나가 주어진다. 하지만 nc를 통해서 서버에 존재하는 플래그를 획득하는 문제이기에 Flag 파일은 분석할 필요가 없다. ELF 실행파일을 동작시켜보면 Fig 2와 같이 동작하는 모습을 확인할 수 있다.
![recon_0]
_Fig 2. 동적 분석_

100번만 가위바위보를 이기면 플래그를 준다!

![가위바위보_필승법]
_fig 3. ???: 이겼다!_

### **SOLUTION**
내공이 부족한 관계로 가위바위보 치트시트를 만들어보자.

로직 자체는 그리 어렵지 않다. 일단 사용자 이름을 입력 받는다.

![logic_1]
_Fig 4. UserName Input Logic_

그 다음으로 컴퓨터의 가위바위보 답안지를 계산한다. 프로그램 내부에 존재하는 하드코딩된 원시값에 사용자 입력으로 답안지를 만든다.

![logic_2]
_Fig 5. Make computer Answer_

그렇다면, 우리는 답안지를 배껴서 만들고, 이를 서버에 제출하여 검증받으면 플래그를 획득할 수 있다.

### **POC**
2개의 파일을 통해서 POC를 작성했다. 답안지를 생성하는 poc.c 파일과 생성한 답안지를 통해 서버에 정답을 보내는 poc.py 파일을 만들었다.

이번 POC를 작성하면서, BYTE를 char가 아닌 unsigned char로 변환하여야 한다는 점을 알게 되었습니다. (이것땜에 poc.c 2번 짬ㅠㅠ)

```c
#include <stdio.h>
#include <string.h>

char DAT_00104020[] =  { 0xa5, 0x90, (중략) 0xcf, 0x37 };

void FUN_001012f7(char *param_1,int param_2)
{
  int idx;
  
  for (idx = 0; idx < 256; idx = idx + 1) {
    DAT_00104020[idx] = param_1[idx % param_2] ^ DAT_00104020[idx];
    DAT_00104020[idx] = DAT_00104020[idx] * '\x10' + ((unsigned char)DAT_00104020[idx] >> 4);
  }
  return;
}

void main() {
    char input[32];
    scanf("%20s", &input);
    int input_len = strlen(input);

    FUN_001012f7(input,input_len);

    unsigned int com_ans[100];
    int my_ans[100];
    unsigned char a;
    printf("[");
    for (int i=0; i < 100; i++) {
        a = (unsigned char)DAT_00104020[(i * input_len) % 256];
        com_ans[i] = ((unsigned int)a + (unsigned int)(a/3) * (-3)) & 255;
        my_ans[i] = ((int)com_ans[i] + 1)%3;
        printf("%d, ", my_ans[i]);
    }
    printf("]\n");
}
```

```python
from pwn import *

conn = remote(HOST, PORT)

conn.recvuntil(b"Enter name(4~20):")
conn.sendline(b"2222")

my_ans = [2, 0, (중략) 1, 0]

conn.recvuntil(b"\nme: ")
for t, ans in enumerate(my_ans):
    print(t, end=": ")
    conn.sendline(str(ans).encode())
    print(conn.recv(timeout=2))
    print(conn.recv(timeout=2))
```

[chall]: /assets/DreamHack/myrand/challenge.png
[recon_0]: /assets/DreamHack/myrand/recon_dynamic.png
[가위바위보_필승법]: /assets/DreamHack/myrand/RCP_receipt.png
[logic_1]: /assets/DreamHack/myrand/logic_input.png
[logic_2]: /assets/DreamHack/myrand/logic_makeAnswer.png